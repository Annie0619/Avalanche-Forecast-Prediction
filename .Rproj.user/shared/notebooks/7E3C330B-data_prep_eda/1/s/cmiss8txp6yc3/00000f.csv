"0","to_fill <- aval %>%"
"0","  filter(is.na(Alt)) %>%"
"0","  transmute(latitude = latitude, longitude = longitude)"
"0",""
"0","elev_tbl <- oe_lookup(to_fill, batch_size = 80, sleep_secs = 1)"
"0",""
"0","# --- 4) Join back and fill Alt where missing ---"
"0","# 1) Build a lookup key on the API results (rounded to match request precision)"
"0","elev_lu <- elev_tbl %>%"
"0","  mutate(key = paste0(round(latitude, 6), ""_"", round(longitude, 6))) %>%"
"0","  select(key, elev_m)"
"0",""
"0","# 2) Build the same key for your aval rows"
"0","aval_key <- paste0(round(aval$latitude, 6), ""_"", round(aval$longitude, 6))"
"0",""
"0","# 3) Match each aval row to the API elevation"
"0","match_idx <- match(aval_key, elev_lu$key)"
"0","alt_from_api <- elev_lu$elev_m[match_idx]   # will be NA where no API result"
"0",""
"0","# 4) Replace Alt in place ONLY where it's missing and we have a lookup value"
"0","fill_idx <- is.na(aval$Alt) & !is.na(alt_from_api)"
"0","aval$Alt[fill_idx] <- alt_from_api[fill_idx]"
"0",""
"0","# 5) Quick check"
"0","cat(""Alt missing before fill:"", sum(is.na(aval$Alt)) + sum(fill_idx == TRUE), ""\n"")"
"1","Alt missing before fill:"
"1"," "
"1","9"
"1"," "
"1","
"
"0","cat(""Alt missing after fill :"", sum(is.na(aval$Alt)), ""\n"")"
"1","Alt missing after fill :"
"1"," "
"1","0"
"1"," "
"1","
"
